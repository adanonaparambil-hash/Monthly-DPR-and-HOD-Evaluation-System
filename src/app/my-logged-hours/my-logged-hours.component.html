<div class="logged-hours-container" [class.dark-mode]="isDarkMode">
  <!-- Header Section -->
  <header class="page-header">
    <div class="header-left">
      <div class="header-info">
        <h1 class="page-title">
          <i class="fas fa-clock animated-clock-title"></i>
          My Logged Hours
        </h1>
        <!-- <p class="page-subtitle">PRODUCTIVITY DASHBOARD</p> -->
      </div>
    </div>
    <div class="header-actions">
      <button class="action-btn secondary" (click)="exportReport()">
        <i class="fas fa-download"></i>
        <span>Export Report</span>
      </button>
      <button class="action-btn primary" (click)="logNewHours()">
        <i class="fas fa-plus"></i>
        <span>Add New Hours</span>
      </button>
    </div>
  </header>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-row">
      <div class="filter-group">
        <label class="filter-label">From Date</label>
        <div class="filter-input-wrapper">
          <i class="fas fa-calendar-alt filter-icon"></i>
          <input type="date" class="filter-date-input" [(ngModel)]="fromDate" (change)="onDateChange()" placeholder="Select from date">
        </div>
      </div>

      <div class="filter-group">
        <label class="filter-label">To Date</label>
        <div class="filter-input-wrapper">
          <i class="fas fa-calendar-alt filter-icon"></i>
          <input type="date" class="filter-date-input" [(ngModel)]="toDate" (change)="onDateChange()" placeholder="Select to date">
        </div>
      </div>

      <div class="filter-group">
        <label class="filter-label">Project</label>
        <select class="filter-select" [(ngModel)]="selectedProject" (change)="onProjectChange()">
          <option value="all">All Projects</option>
          <option *ngFor="let project of projects" [value]="project.projectId">
            {{ project.projectName }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Department</label>
        <select class="filter-select" [(ngModel)]="selectedDepartment" (change)="onDepartmentChange()">
          <option value="all">All Departments</option>
          <option *ngFor="let dept of departments" [value]="dept.departmentId">
            {{ dept.deptName }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Task Category</label>
        <select class="filter-select" [(ngModel)]="selectedTaskCategory" (change)="onTaskCategoryChange()" [disabled]="selectedDepartment === 'all'">
          <option value="all">All Categories</option>
          <option *ngFor="let category of taskCategories" [value]="category.categoryId">
            {{ category.categoryName }}
          </option>
        </select>
      </div>
    </div>

    <div class="filter-actions">
      <button class="filter-btn">
        <i class="fas fa-filter"></i>
        <span>Add Filter</span>
      </button>
      <button class="filter-btn">
        <i class="fas fa-columns"></i>
        <span>Edit Columns</span>
      </button>
    </div>
  </div>

  <!-- Data Table -->
  <div class="data-table">
    <!-- Table Header -->
    <div class="table-header">
      <div class="header-col task-id">Task ID</div>
      <div class="header-col description">Description</div>
      <div class="header-col category">Category / Tags</div>
      <div class="header-col duration">Duration</div>
    </div>

    <!-- Table Body -->
    <div class="table-body">
      <!-- Loading State -->
      <div *ngIf="isLoadingData" class="loading-state">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading logged hours...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoadingData && loggedHours.length === 0" class="empty-state">
        <i class="fas fa-clock"></i>
        <p>No logged hours found for the selected filters</p>
      </div>

      <!-- Dynamic Day Groups -->
      <div class="day-group" *ngFor="let group of getGroupedLoggedHours()">
        <div class="day-header">
          <h3 class="day-title">{{ group.displayDay }}</h3>
          <span class="day-date">{{ group.displayDate }}</span>
        </div>
        <div class="day-records">
          <div class="record-row" *ngFor="let record of group.records" (click)="openTaskDetailsModal(record)" style="cursor: pointer;">
            <div class="record-col task-id">
              <span class="task-id-badge">{{ record.taskId }}</span>
            </div>
            <div class="record-col description">
              <h4 class="task-title">{{ record.title }}</h4>
              <p class="task-description">{{ record.description }}</p>
              <p class="task-project" *ngIf="record.project">
                <i class="fas fa-folder"></i> {{ record.project }}
              </p>
            </div>
            <div class="record-col category">
              <span class="category-badge" [class]="getCategoryClass(record.category)">
                {{ record.category }}
              </span>
              <span class="priority-badge" *ngIf="record.priority" [class]="getPriorityClass(record.priority)">
                {{ record.priority }}
              </span>
            </div>
            <div class="record-col duration">
              <span class="duration-text">{{ record.duration }}</span>
              <button class="more-btn" (click)="$event.stopPropagation()">
                <i class="fas fa-ellipsis-h"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Task Details Modal -->
  <app-task-details-modal
    *ngIf="showTaskDetailsModal"
    [taskId]="selectedTaskIdForModal"
    [userId]="selectedUserIdForModal"
    [categoryId]="selectedCategoryIdForModal"
    (closeModal)="closeTaskDetailsModal()"
    (taskUpdated)="onTaskUpdated($event)"
    (taskPaused)="onTaskPaused($event)"
    (taskResumed)="onTaskResumed($event)"
    (taskStopped)="onTaskStopped($event)">
  </app-task-details-modal>
</div>
