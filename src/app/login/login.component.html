<div class="login-container">
  <!-- Background Image with Overlay -->
  <div class="background-overlay">
    <div class="background-image"></div>
    <div class="dark-overlay"></div>
  </div>

  <!-- Header with Logo -->
  <div class="app-header" [@fadeIn]>
    <div class="logo-container">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
          <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h1 class="app-title">Al Adrak MPR Portal</h1>
    </div>
    <p class="app-tagline">Streamline your time management</p>
  </div>

  <!-- Login Card -->
  <div class="auth-card" *ngIf="currentView === 'login'" [@fadeIn]>
    <div class="auth-header">
      <h2 class="auth-title">{{ getStepTitle() }}</h2>
      <p class="auth-subtitle">{{ getStepDescription() }}</p>
    </div>

    <form class="auth-form" (ngSubmit)="onLogin()" #loginForm="ngForm">
      <!-- Employee ID Field -->
      <div class="input-group">
        <label class="input-label">Employee ID</label>
        <div class="input-container">
          <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 14c-4.41 0-8 2.69-8 6v2h16v-2c0-3.31-3.59-6-8-6z" stroke="currentColor" stroke-width="2"/>
          </svg>
          <input 
            type="text" 
            class="form-input" 
            placeholder="Employee ID"
            [(ngModel)]="username"
            name="username"
            required
            #usernameField="ngModel"
            [class.invalid]="usernameField.invalid && usernameField.touched"
          >
        </div>
        <div *ngIf="usernameField.invalid && usernameField.touched" class="error-message">
          Please enter a valid Employee ID.
        </div>
      </div>

      <!-- Password Field -->
      <div class="input-group">
        <label class="input-label">Password</label>
        <div class="input-container">
          <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="16" r="1" stroke="currentColor" stroke-width="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="currentColor" stroke-width="2"/>
          </svg>
          <input 
            [type]="showPassword() ? 'text' : 'password'" 
            class="form-input" 
            placeholder="Enter your password"
            [(ngModel)]="password"
            name="password"
            required
            #passwordField="ngModel"
            [class.invalid]="passwordField.invalid && passwordField.touched"
          >
          <button 
            type="button" 
            class="password-toggle"
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="showPassword() ? 'Hide password' : 'Show password'">
            <i class="fas" [class.fa-eye]="!showPassword()" [class.fa-eye-slash]="showPassword()"></i>
          </button>
        </div>
        <div *ngIf="passwordField.invalid && passwordField.touched" class="error-message">
          Password must be at least 6 characters long and contain at least one number.
        </div>
      </div>

      <!-- Form Options -->
      <div class="form-options">
        <label class="remember-me">
          <input type="checkbox" class="checkbox">
          <span class="checkbox-label">Remember Me</span>
        </label>
        <button type="button" class="forgot-password-link" (click)="toggleForgotPassword()">
          Forgot password?
        </button>
      </div>

      <!-- Login Button -->
      <button 
        type="submit" 
        class="primary-button"
        [disabled]="!loginForm.valid || isLoggingIn()"
        [class.loading]="isLoggingIn()"
      >
        <i class="fas fa-spinner fa-spin" *ngIf="isLoggingIn()"></i>
        <span>{{ isLoggingIn() ? 'Signing In...' : 'Sign In' }}</span>
      </button>

      <!-- Signup Link -->
      <div class="auth-switch">
        <p>Don't have an account? 
          <button type="button" class="switch-link" (click)="toggleSignup()">
            Sign up here
          </button>
        </p>
      </div>
    </form>
  </div>

  <!-- Multi-Step Form (Forgot Password & Signup) -->
  <div class="auth-card" *ngIf="currentView !== 'login'" [@fadeIn]>
    <div class="auth-header">
      <h2 class="auth-title">{{ getStepTitle() }}</h2>
      <p class="auth-subtitle">{{ getStepDescription() }}</p>
    </div>

    <!-- Step Progress Indicator -->
    <div class="step-progress">
      <div class="step" [class.active]="currentStep === 'email'" [class.completed]="currentStep !== 'email'">
        <div class="step-circle">
          <i class="fas fa-envelope" *ngIf="currentStep === 'email'"></i>
          <i class="fas fa-check" *ngIf="currentStep !== 'email'"></i>
        </div>
        <span>Email</span>
      </div>
      <div class="step-line" [class.completed]="currentStep === 'password'"></div>
      <div class="step" [class.active]="currentStep === 'otp'" [class.completed]="currentStep === 'password'">
        <div class="step-circle">
          <i class="fas fa-key" *ngIf="currentStep === 'otp'"></i>
          <i class="fas fa-check" *ngIf="currentStep === 'password'"></i>
          <span *ngIf="currentStep === 'email'">2</span>
        </div>
        <span>Verify</span>
      </div>
      <div class="step-line" [class.completed]="currentStep === 'password'"></div>
      <div class="step" [class.active]="currentStep === 'password'">
        <div class="step-circle">
          <i class="fas fa-lock" *ngIf="currentStep === 'password'"></i>
          <span *ngIf="currentStep !== 'password'">3</span>
        </div>
        <span>Password</span>
      </div>
    </div>

    <!-- Step 1: Email -->
    <form class="auth-form" *ngIf="currentStep === 'email'" (ngSubmit)="onSubmitEmail()">
      <div class="input-group">
        <label class="input-label">Email Address</label>
        <div class="input-container">
          <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2"/>
            <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2"/>
          </svg>
          <input
            type="email"
            class="form-input"
            [(ngModel)]="email"
            name="email"
            required
            placeholder="Enter your email address"
          />
        </div>
      </div>

      <button type="submit" class="primary-button" [disabled]="isProcessing">
        <i class="fas fa-spinner fa-spin" *ngIf="isProcessing"></i>
        <span>{{ isProcessing ? 'Sending...' : 'Send OTP' }}</span>
      </button>
    </form>

    <!-- Step 2: OTP Verification -->
    <form class="auth-form" *ngIf="currentStep === 'otp'" (ngSubmit)="onVerifyOtp()">
      <div class="input-group">
        <label class="input-label">Enter 6-Digit OTP</label>
        <div class="input-container">
          <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="16" r="1" stroke="currentColor" stroke-width="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="currentColor" stroke-width="2"/>
          </svg>
          <input
            type="text"
            class="form-input otp-input"
            [(ngModel)]="otp"
            name="otp"
            required
            maxlength="6"
            placeholder="000000"
          />
        </div>
        <div class="otp-info">
          <p *ngIf="otpTimer > 0">Resend OTP in {{ (otpTimer/60) | number:'2.0-0' }}:{{ (otpTimer%60) | number:'2.0-0' }}</p>
          <button type="button" class="resend-otp" [disabled]="isProcessing || otpTimer > 0" (click)="onResendOtp()">
            Resend OTP
          </button>
        </div>
      </div>

      <button type="submit" class="primary-button" [disabled]="isProcessing">
        <i class="fas fa-spinner fa-spin" *ngIf="isProcessing"></i>
        <span>{{ isProcessing ? 'Verifying...' : 'Verify OTP' }}</span>
      </button>
    </form>

    <!-- Step 3: Password Setup -->
    <form class="auth-form" *ngIf="currentStep === 'password'" (ngSubmit)="onSetPassword()">
      <!-- Unified minimal fields for both forgot-password and signup -->
      <div class="input-group">
        <label class="input-label">Email ID</label>
        <div class="input-container">
          <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
            <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
            <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
            <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
          </svg>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="employeeId"
            name="employeeId"
            required
            placeholder="Employee ID" disabled="True"
          />
        </div>
      </div>

      <!-- Password fields -->
      <div class="input-group">
        <label class="input-label">{{ currentView === 'signup' ? 'Create Password' : 'New Password' }}</label>
        <div class="input-container">
          <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="16" r="1" stroke="currentColor" stroke-width="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="currentColor" stroke-width="2"/>
          </svg>
          <input
            type="password"
            class="form-input"
            [(ngModel)]="newPassword"
            name="newPassword"
            required
            placeholder="Enter password"
          />
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">Confirm Password</label>
        <div class="input-container">
          <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="16" r="1" stroke="currentColor" stroke-width="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="currentColor" stroke-width="2"/>
          </svg>
          <input
            type="password"
            class="form-input"
            [(ngModel)]="confirmPassword"
            name="confirmPassword"
            required
            placeholder="Confirm password"
          />
        </div>
      </div>

      <button type="submit" class="primary-button" [disabled]="isProcessing">
        <i class="fas fa-spinner fa-spin" *ngIf="isProcessing"></i>
        <span>{{ isProcessing ? 'Processing...' : 'Submit' }}</span>
      </button>
    </form>

    <!-- Messages -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>
    <div *ngIf="successMessage" class="success-message">
      {{ successMessage }}
    </div>

    <!-- Back to Login -->
    <div class="auth-switch">
      <button type="button" class="switch-link" (click)="backToLogin()">
        <i class="fas fa-arrow-left"></i> Back to Login
      </button>
    </div>
  </div>


  <!-- Footer -->
  <div class="app-footer" [@fadeIn]>
    <p>&copy; 2025 Al Adrak Timesheet. All rights reserved.</p>
  </div>
</div>
