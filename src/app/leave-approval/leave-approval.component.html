<div class="leave-approval-container" [@slideInUp]="'in'">


  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button class="tab-button" [class.active]="activeTab === 'pending'" (click)="switchTab('pending')">
      <i class="fas fa-clock"></i>
      <span>Pending Approvals</span>
      <span class="tab-badge" *ngIf="getPendingApprovalsCount() > 0">{{ getPendingApprovalsCount() }}</span>
    </button>
    <button class="tab-button" [class.active]="activeTab === 'myRequests'" (click)="switchTab('myRequests')">
      <i class="fas fa-user-check"></i>
      <span>My Requests</span>
      <span class="tab-badge" *ngIf="myRequests.length > 0">{{ myRequests.length }}</span>
    </button>
  </div>

  <!-- Tab Content -->
  <div class="tab-content" [@tabTransition]>

    <!-- Pending Approvals Tab -->
    <div class="tab-panel" *ngIf="activeTab === 'pending'" [@fadeInUp]="'in'">
      <div class="panel-header">
        <h2><i class="fas fa-hourglass-half"></i> Requests Awaiting Your Approval</h2>
        <div class="filters">
          <div class="filter-group">
            <label class="filter-label">Leave type</label>
            <select [(ngModel)]="typeFilter" class="filter-select">
              <option value="all">All Types</option>
              <option value="emergency">Emergency</option>
              <option value="planned">Planned</option>
              <option value="resignation">Resignation</option>
            </select>
          </div>
          <div class="filter-group">
            <label class="filter-label">Date Range</label>
            <select [(ngModel)]="dateFilter" class="filter-select">
              <option value="all">All Dates</option>
              <option value="today">Today</option>
              <option value="week">This Week</option>
              <option value="month">This Month</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading-container" *ngIf="isLoadingPending">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading pending approvals...</p>
        </div>
      </div>

      <!-- Pending Approvals Table -->
      <div class="requests-table-container" *ngIf="!isLoadingPending">
        <div class="table-wrapper">
          <table class="requests-table" *ngIf="getMyPendingApprovals().length > 0">
            <thead>
              <tr>
                <th>Employee</th>
                <th>Type</th>
                <th>Request Date</th>
                <th>Departure</th>
                <th>Duration</th>
                <th>Reason</th>
                <th>Current Step</th>
                <th>Progress</th>
                <th>Priority</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let request of getMyPendingApprovals(); trackBy: trackByRequestId" class="request-row"
                [class]="getPriorityClass(request.priority)">

                <!-- Employee Info -->
                <td class="employee-cell">
                  <div class="employee-info">
                    <div class="employee-name">{{ request.employeeName }}</div>
                    <div class="employee-details">{{ request.employeeId }} â€¢ {{ request.department }}</div>
                  </div>
                </td>

                <!-- Type -->
                <td class="type-cell">
                  <span class="badge type-badge" [class]="getTypeClass(request.leaveType)">
                    <i class="fas" [class.fa-exclamation-triangle]="request.leaveType === 'Emergency'"
                      [class.fa-calendar-check]="request.leaveType === 'Planned'"
                      [class.fa-user-times]="request.leaveType === 'Resignation'"></i>
                    {{ getFormTypeText(request.leaveType) }}
                  </span>
                </td>

                <!-- Request Date -->
                <td class="date-cell">{{ formatDate(request.requestDate) }}</td>

                <!-- Departure Date -->
                <td class="date-cell">{{ formatDate(request.departureDate) }}</td>

                <!-- Duration -->
                <td class="duration-cell">{{ request.daysRequested }} days</td>

                <!-- Reason -->
                <td class="reason-cell">
                  <div class="reason-text" [title]="request.reason">{{ request.reason }}</div>
                </td>

                <!-- Current Step -->
                <td class="step-cell">
                  <div class="current-step">{{ getCurrentStepName(request) }}</div>
                </td>

                <!-- Progress -->
                <td class="progress-cell">
                  <div class="progress-container">
                    <div class="progress-bar-mini">
                      <div class="progress-fill-mini" [style.width.%]="getWorkflowProgress(request)"></div>
                    </div>
                    <span class="progress-text">{{ getWorkflowProgress(request) }}%</span>
                  </div>
                </td>

                <!-- Priority -->
                <td class="priority-cell">
                  <span class="badge priority-badge" [class]="getPriorityClass(request.priority)">
                    {{ request.priority }}
                  </span>
                </td>

                <!-- Actions -->
                <td class="actions-cell">
                  <div class="action-buttons">
                    <button class="btn-view-table" (click)="viewRequestDetails(request)" title="View & Review">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- No Pending Approvals -->
        <div class="empty-state" *ngIf="getMyPendingApprovals().length === 0">
          <div class="empty-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <h3>No Pending Approvals</h3>
          <p>You have no requests awaiting your approval at this time.</p>
        </div>
      </div>
    </div>

    <!-- My Requests Tab -->
    <div class="tab-panel" *ngIf="activeTab === 'myRequests'" [@fadeInUp]="'in'">
      <div class="panel-header">
        <h2><i class="fas fa-user"></i> My Submitted Requests</h2>
        <div class="filters">
          <div class="filter-group">
            <label class="filter-label">Status</label>
            <select [(ngModel)]="statusFilter" (change)="loadMyRequests()" class="filter-select">
              <option value="all">All Status</option>
              <option value="pending">Pending</option>
              <option value="approved">Approved</option>
              <option value="rejected">Rejected</option>
            </select>
          </div>
          <div class="filter-group">
            <label class="filter-label">Leave type</label>
            <select [(ngModel)]="typeFilter" (change)="loadMyRequests()" class="filter-select">
              <option value="all">All Types</option>
              <option value="emergency">Emergency</option>
              <option value="planned">Planned</option>
              <option value="resignation">Resignation</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading-container" *ngIf="isLoadingMyRequests">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading your requests...</p>
        </div>
      </div>

      <!-- My Requests Table -->
      <div class="requests-table-container" *ngIf="!isLoadingMyRequests">
        <div class="table-wrapper">
          <table class="requests-table" *ngIf="getFilteredMyRequests().length > 0">
            <thead>
              <tr>
                <th>Request ID</th>
                <th>Type</th>
                <th>Submitted Date</th>
                <th>Departure</th>
                <th>Duration</th>
                <th>Reason</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let request of getFilteredMyRequests(); trackBy: trackByRequestId" class="request-row"
                [class]="getStatusClass(request.status)">

                <!-- Request ID -->
                <td class="id-cell">
                  <div class="request-id">{{ request.id }}</div>
                </td>

                <!-- Type -->
                <td class="type-cell">
                  <span class="badge type-badge" [class]="getTypeClass(request.leaveType)">
                    <i class="fas" [class.fa-exclamation-triangle]="request.leaveType === 'Emergency'"
                      [class.fa-calendar-check]="request.leaveType === 'Planned'"
                      [class.fa-user-times]="request.leaveType === 'Resignation'"></i>
                    {{ getFormTypeText(request.leaveType) }}
                  </span>
                </td>

                <!-- Submitted Date -->
                <td class="date-cell">{{ formatDate(request.requestDate) }}</td>

                <!-- Departure Date -->
                <td class="date-cell">{{ formatDate(request.departureDate) }}</td>

                <!-- Duration -->
                <td class="duration-cell">{{ request.daysRequested }} days</td>

                <!-- Reason -->
                <td class="reason-cell">
                  <div class="reason-text" [title]="request.reason">{{ request.reason }}</div>
                </td>

                <!-- Status -->
                <td class="status-cell">
                  <span class="badge status-badge" [class]="getStatusClass(request.status)">
                    {{ request.status }}
                  </span>
                </td>

                <!-- Actions -->
                <td class="actions-cell">
                  <div class="action-buttons">
                    <button class="btn-view-table" (click)="viewMyRequestDetails(request)" title="View Details">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- No Requests -->
        <div class="empty-state" *ngIf="getFilteredMyRequests().length === 0">
          <div class="empty-icon">
            <i class="fas fa-inbox"></i>
          </div>
          <h3>No Requests Found</h3>
          <p>You haven't submitted any requests yet.</p>
        </div>
      </div>
    </div>
  </div>
</div>