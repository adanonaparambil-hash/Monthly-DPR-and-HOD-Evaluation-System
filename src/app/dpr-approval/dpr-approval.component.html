<div class="dpr-approval-container">
  <div class="dpr-layout">
    <!-- Sidebar - Pending Reviews -->
    <aside class="pending-sidebar">
      <!-- Sidebar Header -->
      <div class="sidebar-header">
        <div class="header-title">
          <h2>Pending Reviews</h2>
          <span class="user-count-badge">{{ getTotalPendingUsers() }} Users</span>
        </div>
        
        <!-- Search Input -->
        <div class="search-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input 
            class="search-input" 
            placeholder="Search team member..." 
            type="text"
          />
        </div>
      </div>

      <!-- Users List -->
      <div class="users-list">
        <!-- Empty State for No Users -->
        @if (pendingUsers.length === 0) {
          <div class="users-empty-state">
            <div class="users-empty-icon">
              <i class="fas fa-user-check"></i>
            </div>
            <p class="users-empty-text">No pending reviews</p>
            <span class="users-empty-subtext">All approvals are up to date</span>
          </div>
        }

        <!-- Users List Items -->
        @for (user of pendingUsers; track trackByUserId($index, user)) {
          <div 
            class="user-item"
            [class.selected]="user.isSelected"
            (click)="selectUser(user)"
          >
            <div class="user-content">
              <!-- Avatar or Initials -->
              <div class="user-avatar">
                @if (user.avatar) {
                  <img 
                    [alt]="user.name" 
                    [src]="user.avatar"
                    class="avatar-image"
                  />
                } @else {
                  <div 
                    class="avatar-initials"
                    [class]="getInitialsClass(user.name)"
                  >
                    {{ user.initials || getUserInitials(user.name) }}
                  </div>
                }
              </div>
              
              <!-- User Info -->
              <div class="user-info">
                <div class="user-header">
                  <h3 class="user-name">{{ user.name }}</h3>
                  <span class="last-activity">{{ user.lastActivity }}</span>
                </div>
                <p class="user-role">{{ user.role }}</p>
                <div class="user-badges">
                  <span 
                    class="pending-badge"
                    [class.high-count]="user.pendingLogs > 5"
                  >
                    {{ user.pendingLogs }} Pending Logs
                  </span>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header Section -->
      <div class="content-header">
        <!-- Top Row: Employee Name Only -->
        <div class="header-top-row">
          <div class="selected-user-info">
            <h1 class="user-title">{{ selectedUser?.name || 'Select a User' }}</h1>
            <p class="user-subtitle">Reviewing pending logs for department approval</p>
          </div>
        </div>

        <!-- Bottom Row: Filters and Action Buttons -->
        <div class="filters-container">
          <div class="filters-section">
            <!-- Date Filters -->
            <div class="date-filters">
              <div class="filter-group">
                <label class="filter-label">From Date</label>
                <div class="date-input-wrapper">
                  <i class="fas fa-calendar-alt date-icon"></i>
                  <input 
                    class="filter-input date-input" 
                    type="date" 
                    [(ngModel)]="fromDate"
                  />
                </div>
              </div>
              
              <div class="filter-group">
                <label class="filter-label">To Date</label>
                <div class="date-input-wrapper">
                  <i class="fas fa-calendar-alt date-icon"></i>
                  <input 
                    class="filter-input date-input" 
                    type="date" 
                    [(ngModel)]="toDate"
                  />
                </div>
              </div>
            </div>

            <!-- Divider -->
            <div class="filter-divider"></div>

            <!-- Dropdown Filters -->
            <div class="dropdown-filters">
              <!-- Project Filter Dropdown -->
              <div class="filter-group">
                <label class="filter-label">Project</label>
                <div class="dropdown-wrapper">
                  <select class="filter-dropdown" [(ngModel)]="selectedProject">
                    <option value="all">All Projects</option>
                    <option value="internal">Internal Tools</option>
                    <option value="client">Client Work</option>
                  </select>
                  <i class="fas fa-chevron-down dropdown-icon"></i>
                </div>
              </div>

              <!-- Task Types Filter Dropdown -->
              <div class="filter-group">
                <label class="filter-label">Task Type</label>
                <div class="dropdown-wrapper">
                  <select class="filter-dropdown" [(ngModel)]="selectedTaskTypes">
                    <option value="all">All Types</option>
                    <option value="security">Security</option>
                    <option value="backend">Backend</option>
                    <option value="feature">Feature</option>
                    <option value="bugfix">Bug Fix</option>
                  </select>
                  <i class="fas fa-chevron-down dropdown-icon"></i>
                </div>
              </div>
            </div>

            <!-- Action Buttons Near Input Fields -->
            <div class="header-actions">
              <button 
                class="btn-cancel-header"
                (click)="cancelSelection()"
              >
                Cancel
              </button>
              
              <button 
                class="btn-approve-header"
                (click)="approveSelected()"
                [disabled]="getSelectedLogsCount() === 0"
              >
                <i class="fas fa-check-double"></i>
                <span>Approve All</span>
                @if (getSelectedLogsCount() > 0) {
                  <span class="selection-count">
                    {{ getSelectedLogsCount() }}
                  </span>
                }
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Table Section -->
      <div class="table-section">
        <!-- Empty State -->
        @if (displayedLogs.length === 0 && totalRecords === 0) {
          <div class="empty-state">
            <div class="empty-icon">
              <i class="fas fa-clipboard-check"></i>
            </div>
            <h3 class="empty-title">No Pending Approvals</h3>
            <p class="empty-message">
              All DPR logs have been reviewed! There are no pending approvals for {{ selectedUser?.name || 'this user' }} at the moment.
            </p>
            <div class="empty-stats">
              <div class="empty-stat-item">
                <i class="fas fa-check-circle"></i>
                <span>All caught up!</span>
              </div>
            </div>
          </div>
        }

        <!-- Table Container -->
        @if (displayedLogs.length > 0 || totalRecords > 0) {
          <div class="table-container">
            <div class="table-wrapper">
              <table class="dpr-table">
              <!-- Table Header -->
              <thead>
                <tr>
                  <th class="sl-no-col">Sl No</th>
                  <th class="checkbox-col">
                    <input 
                      class="table-checkbox" 
                      type="checkbox"
                      [checked]="selectAll"
                      (change)="toggleSelectAll()"
                    />
                  </th>
                  <th class="date-col">Date</th>
                  <th class="category-col">Category</th>
                  <th class="title-col">Task Title</th>
                  <th class="description-col">Daily Remarks</th>
                  <th class="project-col">Project</th>
                  <th class="hours-col">Hours</th>
                  <th class="status-col">Status</th>
                </tr>
              </thead>

              <!-- Table Body -->
              <tbody>
                @for (log of displayedLogs; track trackByLogId($index, log); let i = $index) {
                  <tr class="table-row" [class.selected]="log.isSelected">
                    <!-- Serial Number -->
                    <td class="sl-no-cell">
                      <span class="sl-no-text">{{ getSerialNumber(i) }}</span>
                    </td>

                    <!-- Checkbox -->
                    <td class="checkbox-col">
                      <input 
                        class="table-checkbox" 
                        type="checkbox"
                        [checked]="log.isSelected"
                        (change)="toggleLogSelection(log)"
                      />
                    </td>

                    <!-- Date -->
                    <td class="date-cell">
                      <span class="date-text">{{ log.date }}</span>
                    </td>

                    <!-- Category -->
                    <td class="category-cell">
                      <span 
                        class="category-badge"
                        [class]="getCategoryBadgeClass(log.categoryType)"
                      >
                        {{ log.category }}
                      </span>
                    </td>

                    <!-- Task Title -->
                    <td class="title-cell">
                      <span class="task-title" [title]="log.taskTitle">{{ log.taskTitle }}</span>
                    </td>

                    <!-- Task Description -->
                    <td class="description-cell">
                      <span class="task-description" [title]="log.taskDescription">
                        {{ log.taskDescription }}
                      </span>
                    </td>

                    <!-- Project -->
                    <td class="project-cell">
                      <span 
                        class="project-badge"
                        [class]="getProjectBadgeClass(log.projectType)"
                      >
                        {{ log.project }}
                      </span>
                    </td>

                    <!-- Hours -->
                    <td class="hours-cell">
                      <span class="hours-text">{{ log.hours }}</span>
                    </td>

                    <!-- Status -->
                    <td class="status-cell">
                      <span class="status-badge pending">Pending</span>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>

            <!-- Records Count -->
            <div class="table-footer">
              <!-- Remove duplicate records count - it's now in the action footer -->
            </div>
          </div>
        }
      </div>

      <!-- Action Footer - Simplified -->
      @if (displayedLogs.length > 0 || totalRecords > 0) {
        <div class="action-footer">
          <span class="records-info">
            Showing {{ getCurrentPageRange() }} of {{ totalRecords }} pending records
          </span>
          
          <!-- Pagination Controls -->
          <div class="pagination-controls">
            <button 
              class="pagination-btn first" 
              (click)="firstPage()"
              [disabled]="currentPage === 1"
              title="First Page"
            >
              <i class="fas fa-angle-double-left"></i>
            </button>
            
            <button 
              class="pagination-btn prev" 
              (click)="previousPage()"
              [disabled]="currentPage === 1"
              title="Previous Page"
            >
              <i class="fas fa-angle-left"></i>
              <span>Previous</span>
            </button>
            
            <!-- Page Numbers -->
            <div class="page-numbers">
              @for (page of getPageNumbers(); track page) {
                <button 
                  class="page-number-btn"
                  [class.active]="page === currentPage"
                  (click)="goToPage(page)"
                >
                  {{ page }}
                </button>
              }
            </div>
            
            <button 
              class="pagination-btn next" 
              (click)="nextPage()"
              [disabled]="currentPage === totalPages"
              title="Next Page"
            >
              <span>Next</span>
              <i class="fas fa-angle-right"></i>
            </button>
            
            <button 
              class="pagination-btn last" 
              (click)="lastPage()"
              [disabled]="currentPage === totalPages"
              title="Last Page"
            >
              <i class="fas fa-angle-double-right"></i>
            </button>
          </div>
          
          <span class="page-info">
            Page {{ currentPage }} of {{ totalPages }}
          </span>
        </div>
      }
    </main>
  </div>
</div>