<div class="monthly-dpr-page" [@slideIn]>
  <!-- Header -->
  <div class="header-section" [@scaleIn]>
  <div class="header-content">
    <h1>Monthly DPR Report</h1>
    <p><i class="fas fa-calendar-alt"></i> <b> {{ monthYear }} </b></p>
  </div>
  <div class="header-actions">

  </div>
</div>


  <!-- Employee Info Card -->
  <div class="info-card" [@scaleIn]>
    <div class="info-row">
      <div class="info-item">
        <label><b>Employee Id</b></label>
        <input [(ngModel)]="empId" placeholder="Enter employee ID" disabled>
      </div>
      <div class="info-item">
        <label><b>Name</b></label>
        <input [(ngModel)]="empName" placeholder="Enter your full name" disabled>
      </div>
      <div class="info-item">
        <label><b>Designation</b></label>
        <input [(ngModel)]="designation" placeholder="Enter your designation" disabled>
      </div>
      <div class="info-item">
        <label><b>Department</b></label>
          <input [(ngModel)]="department"  placeholder="Enter your department" disabled>
      </div>
    </div>
    <div class="info-row">
      <div class="info-item">
        <label><b>Reporting To</b></label>
        <input [(ngModel)]="reportingTo" placeholder="Enter reporting manager" disabled>
      </div>

      <div class="info-item">
        <label><b>Worked Hours</b></label>
        <input type="number" [(ngModel)]="WorkedHours" placeholder="Enter Worked Hours: e.g., 160">
      </div>

    </div>
    
  </div>

  <!-- Support Needed Section -->
  <div class="support-card" [@scaleIn]>
    <h3><i class="fas fa-handshake colorful-icon"></i> Support Needed / Suggestions</h3>
    <p>Specify the support you need from management, team or resources. Include any suggestions for process improvement...</p>
    <textarea [(ngModel)]="supportNeeded" placeholder="Enter your support requirements..."></textarea>
  </div>


   <!-- Achievements and Challenges -->
  <div class="achievements-challenges" [@scaleIn]>
    <div class="achievement-card">
       <h3><i class="fas fa-trophy colorful-icon"></i> Achievements</h3>
      <p>Describe your major accomplishments, achievements, deliverables and quality deliverables...</p>
      <textarea [(ngModel)]="achievements" placeholder="Enter your achievements..."></textarea>
    </div>
    <div class="challenge-card">
       <h3><i class="fas fa-question-circle colorful-icon"></i> Challenges</h3>
      <p>Detail the challenges you encountered, the steps taken to address them...</p>
      <textarea [(ngModel)]="challenges" placeholder="Enter challenges faced..."></textarea>
    </div>
  </div>

  <!-- Task Details Section -->
  <div class="task-card" [@scaleIn]>
    <div class="section-header">
    <h2><i class="fas fa-hourglass-half"></i> Task Details</h2>
      <div class="button-container">
      <button class="add-btn ptask" (click)="GetProofHubTask()">Get ProofHub Task History</button>
      <button class="add-btn" (click)="addNewTask()">+ Add New Task</button> 
    </div>
    </div>
    
    <div class="table-container my-task-table">
      <table>
        <thead>
          <tr>
            <th class="SlNo-col">SL No</th>
            <th class="task-col">Task Name</th>
            <th class="desc-col">Task Description and Status</th>
            <th class="hours-col">Estimated Hours</th>
            <th class="hours-col">Actual Hours</th>
            <th class="productivity-col">Productivity %</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let task of tasks; let i = index">
            <td class="SlNo-col">{{ i + 1 }}</td>
            <td class="task-col">
              <textarea [(ngModel)]="task.taskName" placeholder="Task name"></textarea>
            </td>
            <td class="desc-col">
              <textarea [(ngModel)]="task.description" placeholder="Description and status"></textarea>
            </td>
            <td class="hours-col">
              <input type="number" [(ngModel)]="task.estimatedHours" placeholder="0" (input)="calculateProductivity(task)">
            </td>
            <td class="hours-col">
              <input type="number" [(ngModel)]="task.actualHours" placeholder="0" (input)="calculateProductivity(task)">
            </td>
            <td class="productivity-col">
              <input type="number" [value]="task.productivity" placeholder="0" disabled>
            </td>
          </tr>
        </tbody>
      </table>
    </div>



  </div>

  <!-- KPI Performance Section -->
  <div class="kpi-card" [@scaleIn]>
    <div class="section-header">
      <h2><i class="fas fa-chart-line"></i> KPI Performance</h2>
      <button class="add-btn" (click)="addNewKPI()">+ Add New KPI</button>
    </div>
    
    
    <div class="table-container kpi-table">
      <table>
        <thead>
          <tr>
            <th class="SlNo-col">Sl No</th>
            <th class="kpi-col">KPI</th>
            <th class="kpi-value-col">KPI Value</th>
            <th class="remarks-col">Remarks</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let kpi of kpis; let i = index">
            <td class="SlNo-col">{{ i + 1 }}</td>

            <!-- KPI Name (read-only) -->
            <td class="kpi-col">{{ kpi.kpiDescription }}</td>

            <!-- KPI Value Dropdown -->
            <td class="kpi-value-col">
              <select [(ngModel)]="kpi.kpiValue">
                <option value="0">Rate out of 5</option>
                <option value="1">1 - Poor</option>
                <option value="2">2 - Below Average</option>
                <option value="3">3 - Average</option>
                <option value="4">4 - Good</option>
                <option value="5">5 - Excellent</option>
              </select>
            </td>

            <!-- Remarks -->
            <td class="remarks-col">
              <textarea [(ngModel)]="kpi.remarks" placeholder="Remarks"></textarea>
            </td>
          </tr>
        </tbody>
      </table>

    </div>



  </div>

 

  <!-- HOD Evaluation Section -->
  <div class="evaluation-card" [@scaleIn]>
    <div class="section-header" (click)="toggleHodEvaluation()">
      <div class="header-left">
        <i class="fas fa-star"></i>
        <span>HOD Evaluation</span>
      </div>
      <i class="fas" [class.fa-chevron-down]="showHodEvaluation" [class.fa-chevron-right]="!showHodEvaluation"></i>
    </div>
    
    <div class="evaluation-content" *ngIf="showHodEvaluation" [@fadeInUp]>
      <div class="evaluation-grid">
        <div class="eval-item">
          <label>Quality</label>
          <select [(ngModel)]="quality" class="rating-dropdown">
            <option value="0">Rate out of 5</option>
            <option value="1">1 - Poor</option>
            <option value="2">2 - Below Average</option>
            <option value="3">3 - Average</option>
            <option value="4">4 - Good</option>
            <option value="5">5 - Excellent</option>
          </select>
        </div>
        <div class="eval-item">
          <label>Timeliness</label>
          <select [(ngModel)]="timeliness" class="rating-dropdown">
            <option value="0">Rate out of 5</option>
            <option value="1">1 - Poor</option>
            <option value="2">2 - Below Average</option>
            <option value="3">3 - Average</option>
            <option value="4">4 - Good</option>
            <option value="5">5 - Excellent</option>
          </select>
        </div>
        <div class="eval-item">
          <label>Initiative</label>
          <select [(ngModel)]="initiative" class="rating-dropdown">
            <option value="0">Rate out of 5</option>
            <option value="1">1 - Poor</option>
            <option value="2">2 - Below Average</option>
            <option value="3">3 - Average</option>
            <option value="4">4 - Good</option>
            <option value="5">5 - Excellent</option>
          </select>
        </div>
        <div class="eval-item">
          <label>Overall Score</label>
          <select [(ngModel)]="overallScore" class="rating-dropdown">
            <option value="0">Rate out of 5</option>
            <option value="1">1 - Poor</option>
            <option value="2">2 - Below Average</option>
            <option value="3">3 - Average</option>
            <option value="4">4 - Good</option>
            <option value="5">5 - Excellent</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Management Remarks Section -->
  <div class="remarks-card" [@scaleIn]>
    <div class="section-header" (click)="toggleManagementRemarks()">
      <div class="header-left">
        <i class="fas fa-comment"></i>
        <span>Management Remarks</span>
      </div>
      <i class="fas" [class.fa-chevron-down]="showManagementRemarks" [class.fa-chevron-right]="!showManagementRemarks"></i>
    </div>
    
    <div class="remarks-content" *ngIf="showManagementRemarks" [@fadeInUp]>
      <p>Add your remarks about the employee's performance...</p>
      <textarea [(ngModel)]="managementRemarks" placeholder="Enter management remarks..."></textarea>
    </div>
  </div>

  <!-- Remarks History Section -->
  <div class="history-card" [@scaleIn]>
    <div class="section-header" (click)="toggleRemarksHistory()">
      <div class="header-left">
        <i class="fas fa-history"></i>
        <span>Remarks History</span>
      </div>
      <i class="fas" [class.fa-chevron-down]="showRemarksHistory" [class.fa-chevron-right]="!showRemarksHistory"></i>
    </div>
    
    <div class="history-content" *ngIf="showRemarksHistory" [@fadeInUp]>
      <div class="history-item" *ngFor="let remark of remarksHistory" [@scaleIn]>
        <div class="history-header">
          <div class="history-user">
            <i class="fas fa-user-circle"></i>
            <span class="user-name">{{ remark.hodId }}</span>
            <span class="status-badge" [class]="'status-' + remark.commentType.toLowerCase()">{{ remark.commentType }}</span>
          </div>
          <span class="history-date">{{ remark.CREATEDAT }}</span>
        </div>
        <p class="history-comment">{{ remark.commentText }}</p>
      </div>
    </div>
  </div>

  
  <!-- Action Buttons (Now under Achievements/Challenges, right aligned) -->
  <div class="action-buttons right-action-buttons" [@scaleIn]>
    <button class="btn-draft colorful-btn" (click)="saveDraft()">
      <i class="fas fa-save"></i> Save as Draft
    </button>
    <button class="btn-available colorful-btn" (click)="SubmitReview()">
      <i class="fas fa-check"></i> Submit for Review
    </button>
    <button class="btn-approve colorful-btn" (click)="ApproveReview()">
      <i class="fas fa-thumbs-up"></i> Approve
    </button>
    <button class="btn-pushback colorful-btn" (click)="ReWorkReview()">
      <i class="fas fa-undo"></i> Rework
    </button>
  </div>
</div>


<!-- Modal -->
<div *ngIf="showModal" class="modal-overlay">
  <div class="modal-box" [@scaleIn]>

    <!-- Header -->
    <div class="modal-header">
      <span class="back-arrow" (click)="closeModal()">&#8592;</span>
      <h2>ProofHub Task History</h2>
      <!-- Removed close button from header -->
    </div>

    <!-- Body -->
    <div class="modal-body">
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th class="SlNo-col">SL No</th>
              <th class="task-col">Task Name</th>
              <th class="desc-col">Task Description</th>
              <th class="date-col">Start Date</th>
              <th class="date-col">Due Date</th>
              <th class="hours-col">Estimated Hours</th>
              <th class="hours-col">Logged Hours</th>
              <th class="select-col">Select</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let task of Proofhubtasks; let i = index">
              <td>{{ i + 1 }}</td>
              <td class="task-col">{{ task.TASK_TITLE }}</td>
              <td class="desc-col">{{ task.TASK_DESCRIPTION }}</td>
              <td class="date-col">{{ task.START_DATE }}</td>
              <td class="date-col">{{ task.DUE_DATE }}</td>
              <td class="hours-col">{{ task.ESTIMATED_HOURS }}</td>
              <td class="hours-col">{{ task.LOGGED_HOURS }}</td>
              <td><input type="checkbox" [(ngModel)]="task.selected" /></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Summary Text Area (Visible by default) -->
      <div *ngIf="summaryText" class="summary-box">
        <h3>AI Generated Summary</h3>
        <textarea readonly>{{ summaryText }}</textarea>
      </div>

      <!-- Generate Summary Button and Close Button -->
      <div class="summary-actions">
        <button class="generate-summary-btn" (click)="generateSummary()">Generate Summary</button>
        <button class="close-modal-btn" (click)="closeModal()">Close</button>
      </div>
    </div>
  </div>
</div>
