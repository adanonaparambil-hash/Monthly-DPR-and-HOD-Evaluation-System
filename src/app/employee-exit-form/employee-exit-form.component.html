<div class="employee-exit-container">
  <div class="form-header">
    <h1>Employee Exit Form (Planned Leave)</h1>
    <p>Planned leave application form</p>
  </div>

  <div class="form-content">
    <form [formGroup]="exitForm">
      <div class="form-section">
        <h3>Employee Information</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="employeeName">Name *</label>
            <input type="text" 
                   id="employeeName" 
                   formControlName="employeeName"
                   placeholder="Employee Name"
                   readonly
                   tabindex="1"> 
          </div>
          
          <div class="form-group">
            <label for="employeeId">ID No. *</label>
            <input type="text" 
                   id="employeeId" 
                   formControlName="employeeId"
                   placeholder="Employee ID"
                   readonly
                   tabindex="2">
          </div>
          
          <div class="form-group">
            <label for="department">Department *</label>
            <input type="text" 
                   id="department" 
                   formControlName="department"
                   placeholder="Department"
                   readonly
                   tabindex="3">
          </div>
          
          <div class="form-group">
            <label for="plannedLeaveDate">Planned Leave Date *</label>
            <input type="date" 
                   id="plannedLeaveDate" 
                   formControlName="plannedLeaveDate"
                   tabindex="4">
          </div>
          
          <div class="form-group">
            <label for="returnDate">Return Date *</label>
            <input type="date" 
                   id="returnDate" 
                   formControlName="returnDate"
                   tabindex="5">
          </div>
          
          <div class="form-group">
            <label for="reason">Reason for Leave *</label>
            <textarea id="reason" 
                      formControlName="reason"
                      rows="4"
                      placeholder="Please provide reason for planned leave"
                      tabindex="6"></textarea>
          </div>
          
          <div class="form-group hod-dropdown-group">
            <label for="hodName">HOD Name *</label>
            <select id="hodName" formControlName="hodName" tabindex="7">
              <option value="">Select HOD</option>
              @for (hod of hodList; track hod.idValue) {
                <option [value]="hod.idValue">
                  {{ hod.description }}
                </option>
              } @empty {
                <option value="" disabled>Loading HODs...</option>
              }
            </select>
            <!-- Debug info - remove in production -->
            <small style="color: #666; font-size: 12px;">
              HOD Count: {{ hodList.length }} | 
              Session User: {{ currentUser?.employeeName || 'Not found' }} | 
              Department: {{ currentUser?.department || 'Not found' }}
            </small>
          </div>

          <div class="form-group project-manager-dropdown-group">
            <label for="projectManagerName">Project Manager / Site Incharge *</label>
            <select id="projectManagerName" formControlName="projectManagerName" tabindex="8">
              <option value="">Select Project Manager / Site Incharge</option>
              @for (pm of projectManagerList; track pm.idValue) {
                <option [value]="pm.idValue">
                  {{ pm.description }}
                </option>
              } @empty {
                <option value="" disabled>Loading Project Managers...</option>
              }
            </select>
            <!-- Debug info - remove in production -->
            <small style="color: #666; font-size: 12px;">
              Project Manager Count: {{ projectManagerList.length }}
            </small>
          </div>

          <div class="form-group responsibilities-dropdown-group">
            <label for="responsibilitiesHandedOverTo">Responsibilities Handed Over To *</label>
            <div class="searchable-dropdown">
              <input type="text" 
                     id="responsibilitiesHandedOverTo" 
                     formControlName="responsibilitiesHandedOverTo"
                     placeholder="Search and select employee..." 
                     class="dropdown-input" 
                     #searchInput
                     (input)="onSearchInputChange($event)" 
                     (focus)="showDropdown()" 
                     (blur)="hideDropdown()" 
                     autocomplete="off"
                     tabindex="9">
              <div class="dropdown-icon">
                <i class="fas fa-chevron-down"></i>
              </div>
              @if (isDropdownVisible) {
                <div class="dropdown-list" 
                     [class.small-list]="shouldUseSmallDropdown(searchTerm)">
                  @for (employee of getFilteredEmployees(searchTerm); track employee.idValue) {
                    <div class="dropdown-item" 
                         (mousedown)="selectEmployee(employee)"
                         [class.selected]="isEmployeeSelected(employee)">
                      <div class="employee-info">
                        <div class="employee-name">{{ getEmployeeName(employee.description || '') }}</div>
                        <div class="employee-id">{{ employee.idValue || '' }}</div>
                      </div>
                    </div>
                  } @empty {
                    <div class="no-results">
                      No employees found
                    </div>
                  }
                </div>
              }
            </div>
          </div>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="button" class="btn-secondary" tabindex="10">Cancel</button>
        <button type="button" class="btn-primary" (click)="submitForm()" tabindex="11">Submit</button>
      </div>
    </form>
  </div>
</div>
