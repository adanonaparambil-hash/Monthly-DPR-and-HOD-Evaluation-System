<div class="layout-container" [class.dark-theme]="isDarkMode" [class.sidebar-collapsed]="sidebarCollapsed">
  <!-- Session Monitor -->
  <app-session-monitor></app-session-monitor>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <img src="assets/images/logo.png" alt="Company Logo" class="sidebar-logo-image">
      <span>Adrak Portal</span>
    </div>

    <nav class="menu">
      <!-- Dashboard Menu - Keep as is -->
      <a *ngIf="isEmployee" routerLink="/employee-dashboard" routerLinkActive="active" (click)="closeSidebarOnMobile()">
        <i class="fas fa-chart-pie"></i> Employee Analytics
      </a>
      <a *ngIf="isHod" routerLink="/hod-dashboard" routerLinkActive="active" (click)="closeSidebarOnMobile()">
        <i class="fas fa-users-cog"></i> HOD Dashboard
      </a>
      <a *ngIf="isCed" routerLink="/ced-dashboard" routerLinkActive="active" (click)="closeSidebarOnMobile()">
        <i class="fas fa-chart-line"></i> Dashboard
      </a>

      <!-- MPR Menu with Sub-items -->
      <div class="menu-item-with-submenu">
        <a class="parent-menu" (click)="toggleMPRMenu()" [class.active]="isMPRRouteActive()">
          <div class="menu-content">
            <i class="fas fa-file-alt"></i>
            <span>MPR</span>
          </div>
          <i class="fas fa-chevron-down" [class.rotated]="isMPRMenuOpen"></i>
        </a>
        <div class="submenu" *ngIf="isMPRMenuOpen" [@slideDown]>
          <a routerLink="/monthly-dpr" routerLinkActive="active" (click)="closeSidebarOnMobile()">
            <i class="fas fa-edit"></i>
            <span>MPR Entry</span>
          </a>
          <a routerLink="/past-reports" routerLinkActive="active" (click)="closeSidebarOnMobile()">
            <i class="fas fa-history"></i>
            <span>MPR Past Reports</span>
          </a>
        </div>
      </div>

      <!-- Approvals Menu (Empty for now, for future use) -->
      <div class="menu-item-with-submenu">
        <a class="parent-menu" (click)="toggleApprovalsMenu()" [class.active]="isApprovalsRouteActive()">
          <div class="menu-content">
            <i class="fas fa-check-circle"></i>
            <span>Approvals</span>
          </div>
          <i class="fas fa-chevron-down" [class.rotated]="isApprovalsMenuOpen"></i>
        </a>
        <div class="submenu" *ngIf="isApprovalsMenuOpen" [@slideDown]>
          <a routerLink="/leave-approval" routerLinkActive="active" (click)="closeSidebarOnMobile()">
            <i class="fas fa-clipboard-check"></i>
            <span>Leave Approval</span>
          </a>
        </div>
      </div>

      <!-- Exit Form Menu - Single Item -->
      <a routerLink="/exit-form" routerLinkActive="active" (click)="closeSidebarOnMobile()">
        <i class="fas fa-plane-departure"></i> Exit Form
      </a>

      <!-- Profile Menu - Keep as is -->
      <a routerLink="/profile" routerLinkActive="active" (click)="closeSidebarOnMobile()">
        <i class="fas fa-user"></i> My Profile
      </a>
    </nav>

    <div class="logout">
      <b><a (click)="logout()" [class.disabled]="isLoggingOut">
        <i class="fas fa-sign-out-alt"></i>Logout
      </a></b>
    </div>
  </aside>

  <!-- Main Content Area -->
  <div class="main-area">
    <!-- Header -->
    <header class="header" [@slideDown]>
      <div class="header-left">
        <button class="menu-toggle" (click)="toggleSidebar()">
          <i class="fas fa-bars"></i>
        </button>
        <div class="page-title-section">
          <h1 class="page-title">{{ getPageTitle() }}</h1>
          <p class="page-subtitle" *ngIf="getPageSubtitle()">{{ getPageSubtitle() }}</p>
          <p class="welcome-text" *ngIf="isDashboardRoute()">Welcome, <strong>{{ userProfile.name }}</strong>. Wishing you a great day ahead.</p>
        </div>
      </div>
      
      <div class="header-right">
        <!-- Dark/Light Mode Toggle -->
        <button class="theme-toggle" (click)="toggleTheme()" [title]="isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
          <i class="fas" [class.fa-sun]="isDarkMode" [class.fa-moon]="!isDarkMode"></i>
        </button>
        
        <!-- Notifications -->
        <div class="notification-wrapper">
          <button class="notification-btn" 
                  [class.has-notifications]="notificationCount > 0"
                  [class.urgent-notifications]="notificationCount > 5"
                  (click)="toggleNotifications()">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" 
                  [class.urgent]="notificationCount > 5"
                  [class.new-notification]="hasNewNotifications"
                  *ngIf="notificationCount > 0">{{ notificationCount }}</span>
          </button>
          
          <div class="notification-dropdown" *ngIf="showNotifications" [@slideDown]>
            <div class="notification-header">
              <h3>Notifications ({{ notificationCount }})</h3>
              <div class="notification-actions">
                <button class="refresh-btn" (click)="refreshNotifications()" title="Refresh notifications">
                  <i class="fas fa-sync-alt" [class.fa-spin]="isLoadingNotifications"></i>
                </button>
                <button class="mark-all-btn" (click)="markAllAsRead()" [disabled]="notificationCount === 0" title="Mark all as read">
                  <i class="fas fa-check-double"></i>
                </button>
                <button class="clear-all-btn" (click)="clearAllNotifications()" [disabled]="notifications.length === 0" title="Clear all notifications">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <div class="notification-list">
              <!-- Loading state -->
              <div class="notification-loading" *ngIf="isLoadingNotifications">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Loading notifications...</span>
              </div>
              
              <!-- Notifications -->
              <div class="notification-item" 
                   *ngFor="let notification of notifications; trackBy: trackNotificationById"
                   [class.unread]="!notification.isRead"
                   [@slideDown]>
                <div class="notification-icon">
                  <i [class]="notification.icon"></i>
                </div>
                <div class="notification-content" (click)="navigateToNotification(notification, $event)">
                  <p>{{ notification.message }}</p>
                  <span class="notification-time">{{ notification.time }}</span>
                </div>
                <div class="notification-actions-item">
                  <button *ngIf="!notification.isRead" 
                          class="mark-read-btn" 
                          (click)="markNotificationAsRead(notification.id, $event)" 
                          title="Mark as read">
                    <i class="fas fa-check"></i>
                  </button>
                  <button class="delete-btn" 
                          (click)="clearNotification(notification.id, $event)" 
                          title="Delete notification">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <div class="notification-status" *ngIf="!notification.isRead">
                  <div class="unread-dot"></div>
                </div>
              </div>
              
              <!-- Empty state -->
              <div class="notification-empty" *ngIf="!isLoadingNotifications && notifications.length === 0">
                <i class="fas fa-bell-slash"></i>
                <span>No notifications</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Profile -->
        <div class="profile-wrapper">
          <button class="profile-btn" (click)="toggleProfile()">
            <img [src]="userProfile.avatar" [alt]="userProfile.name" class="profile-avatar">
            <span class="profile-name">{{ userProfile.name }}</span>
            <i class="fas fa-chevron-down"></i>
          </button>
          
          <div class="profile-dropdown" *ngIf="showProfile" [@slideDown]>
            <div class="profile-info">
              <img [src]="userProfile.avatar" [alt]="userProfile.name" class="profile-avatar-large">
              <div>
                <h4>{{ userProfile.name }}</h4>
                <p>{{ userProfile.role }}</p>
              </div>
            </div>
            <div class="profile-menu">
              <a routerLink="/profile"><i class="fas fa-user"></i> My Profile</a>
              <!-- <a href="#"><i class="fas fa-cog"></i> Settings</a> -->
              <a (click)="logout()" [class.disabled]="isLoggingOut"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Content -->
    <main class="content" [@fadeIn]>
      <router-outlet></router-outlet>
    </main>
  </div>
</div>
