<div class="layout-container" [class.dark-theme]="isDarkMode">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <i class="fas fa-chart-bar"></i>
      <span>MPR Portal</span>
    </div>

    <nav class="menu">
      <!-- <a routerLink="/dashboard" routerLinkActive="active">
        <i class="fas fa-tachometer-alt"></i> Dashboard
      </a> -->
      <a *ngIf="isEmployee" routerLink="/employee-dashboard" routerLinkActive="active">
        <i class="fas fa-chart-pie"></i> Employee Analytics
      </a>
      <a *ngIf="isHod" routerLink="/hod-dashboard" routerLinkActive="active">
        <i class="fas fa-users-cog"></i> HOD Dashboard
      </a>
      <a *ngIf="isCed" routerLink="/ced-dashboard" routerLinkActive="active">
        <i class="fas fa-chart-line"></i> CED Dashboard
      </a>
      <a routerLink="/monthly-dpr" routerLinkActive="active">
        <i class="fas fa-file-alt"></i> MPR Entry
      </a>
      <a routerLink="/past-reports" routerLinkActive="active">
        <i class="fas fa-history"></i> Past Reports
      </a>
      <div class="menu-item-with-submenu">
        <a class="parent-menu" (click)="toggleExitFormMenu()" [class.active]="isExitFormRouteActive()">
          <div class="menu-content">
            <i class="fas fa-plane-departure"></i>
            <span>Exit Form</span>
          </div>
          <i class="fas fa-chevron-down" [class.rotated]="isExitFormMenuOpen"></i>
        </a>
        <div class="submenu" *ngIf="isExitFormMenuOpen" [@slideDown]>
          <a routerLink="/emergency-exit-form" [queryParams]="{type: 'E'}" routerLinkActive="active">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Emergency Exit Form</span>
          </a>
          <a routerLink="/emergency-exit-form" [queryParams]="{type: 'P'}" routerLinkActive="active">
            <i class="fas fa-calendar-check"></i>
            <span>Employee Exit Form (Planned Leave)</span>
          </a>
        </div>
      </div>
      <a routerLink="/profile" routerLinkActive="active">
        <i class="fas fa-user"></i> My Profile
      </a>
    </nav>

    <div class="logout">
      <b><a (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>Logout
      </a></b>
    </div>
  </aside>

  <!-- Main Content Area -->
  <div class="main-area">
    <!-- Header -->
    <header class="header" [@slideDown]>
      <div class="header-left">
        <button class="menu-toggle" (click)="toggleSidebar()">
          <i class="fas fa-bars"></i>
        </button>
        <div class="company-logo">
          <img src="assets/images/logo.jpg" alt="Company Logo" class="logo-image">
         <!-- <span class="company-name">Al Adrak DPR Portal</span> -->
        </div>
        <h1 class="page-title">{{ getPageTitle() }}</h1>
      </div>
      
      <div class="header-right">
        <!-- Dark/Light Mode Toggle -->
        <button class="theme-toggle" (click)="toggleTheme()" [title]="isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
          <i class="fas" [class.fa-sun]="isDarkMode" [class.fa-moon]="!isDarkMode"></i>
        </button>
        
        <!-- Notifications -->
        <div class="notification-wrapper">
          <button class="notification-btn" 
                  [class.has-notifications]="notificationCount > 0"
                  [class.urgent-notifications]="notificationCount > 5"
                  (click)="toggleNotifications()">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" 
                  [class.urgent]="notificationCount > 5"
                  [class.new-notification]="hasNewNotifications"
                  *ngIf="notificationCount > 0">{{ notificationCount }}</span>
          </button>
          
          <div class="notification-dropdown" *ngIf="showNotifications" [@slideDown]>
            <div class="notification-header">
              <h3>Notifications</h3>
              <div class="notification-actions">
                <button class="refresh-btn" (click)="loadNotifications()" title="Refresh notifications">
                  <i class="fas fa-sync-alt" [class.fa-spin]="isLoadingNotifications"></i>
                </button>
                <button (click)="markAllAsRead()" [disabled]="notificationCount === 0">
                  Mark all as read
                </button>
              </div>
            </div>
            <div class="notification-list">
              <!-- Loading state -->
              <div class="notification-loading" *ngIf="isLoadingNotifications">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Loading notifications...</span>
              </div>
              
              <!-- Notifications -->
              <div class="notification-item" 
                   *ngFor="let notification of notifications"
                   [class.unread]="!notification.isRead"
                   (click)="markNotificationAsRead(notification.id)">
                <div class="notification-icon">
                  <i [class]="notification.icon"></i>
                </div>
                <div class="notification-content">
                  <p>{{ notification.message }}</p>
                  <span class="notification-time">{{ notification.time }}</span>
                </div>
                <div class="notification-status" *ngIf="!notification.isRead">
                  <div class="unread-dot"></div>
                </div>
              </div>
              
              <!-- Empty state -->
              <div class="notification-empty" *ngIf="!isLoadingNotifications && notifications.length === 0">
                <i class="fas fa-bell-slash"></i>
                <span>No notifications</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Profile -->
        <div class="profile-wrapper">
          <button class="profile-btn" (click)="toggleProfile()">
            <img [src]="userProfile.avatar" [alt]="userProfile.name" class="profile-avatar">
            <span class="profile-name">{{ userProfile.name }}</span>
            <i class="fas fa-chevron-down"></i>
          </button>
          
          <div class="profile-dropdown" *ngIf="showProfile" [@slideDown]>
            <div class="profile-info">
              <img [src]="userProfile.avatar" [alt]="userProfile.name" class="profile-avatar-large">
              <div>
                <h4>{{ userProfile.name }}</h4>
                <p>{{ userProfile.role }}</p>
              </div>
            </div>
            <div class="profile-menu">
              <a routerLink="/profile"><i class="fas fa-user"></i> My Profile</a>
              <!-- <a href="#"><i class="fas fa-cog"></i> Settings</a> -->
              <a (click)="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Content -->
    <main class="content" [@fadeIn]>
      <router-outlet></router-outlet>
    </main>
  </div>
</div>
