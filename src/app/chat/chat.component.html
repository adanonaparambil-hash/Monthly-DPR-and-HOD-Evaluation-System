<div class="chat-container">
  <div class="chat-content">
    <!-- Sidebar - Chat Groups -->
    <div class="chat-sidebar">
      <!-- Chats Header -->
      <div class="sidebar-header">
        <div class="sidebar-title">
          <h2>Chats</h2>
          <button class="new-chat-btn" (click)="createNewGroup()" title="Create new group">
            <i class="fas fa-edit"></i>
          </button>
        </div>
        
        <!-- Search -->
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input 
            type="text" 
            placeholder="Search groups (Ctrl+K)" 
            [(ngModel)]="searchQuery"
            (input)="searchGroups()"
            class="search-input">
        </div>
      </div>

      <!-- Pinned Section -->
      <div class="chat-section pinned-section" *ngIf="hasPinnedGroups()">
        <div class="section-header">
          <i class="fas fa-thumbtack section-icon"></i>
          <span class="section-title">PINNED</span>
        </div>
        
        <div class="chat-list pinned-list">
          <ng-container *ngFor="let group of filteredGroups">
            <div 
              *ngIf="group.isPinned"
              class="chat-item pinned-item"
              [class.active]="selectedGroup?.id === group.id"
              [attr.data-group-name]="group.name"
              (click)="selectGroup(group)">
              
              <div class="chat-avatar">
                <img *ngIf="group.avatar && group.avatar.startsWith('assets')" 
                     [src]="group.avatar" 
                     [alt]="group.name"
                     class="avatar-img">
                <div *ngIf="!group.avatar || !group.avatar.startsWith('assets')" 
                     class="avatar-placeholder">
                  {{ group.avatar || group.name.charAt(0) }}
                </div>
                <div class="online-indicator" *ngIf="group.isOnline"></div>
              </div>
              
              <div class="chat-info">
                <div class="chat-header-info">
                  <h3 class="chat-name">{{ group.name }}</h3>
                  <span class="chat-time">{{ group.lastMessageTime }}</span>
                </div>
                <div class="chat-preview">
                  <p class="last-message">{{ group.lastMessage }}</p>
                  <div class="chat-meta">
                    <span *ngIf="group.memberCount && group.memberCount > 0" class="member-count">
                      <i class="fas fa-users"></i> {{ group.memberCount }} members â€¢ 3 online
                    </span>
                    <span *ngIf="group.unreadCount && group.unreadCount > 0" class="unread-badge">
                      {{ group.unreadCount }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>

      <!-- All Messages Section (Combined) -->
      <div class="chat-section all-messages-section">
        <div class="section-header">
          <i class="fas fa-comments section-icon"></i>
          <span class="section-title">ALL MESSAGES</span>
        </div>
        
        <div class="chat-list all-messages-list">
          <!-- Show all messages including pinned ones -->
          <div 
            *ngFor="let group of filteredGroups" 
            class="chat-item"
            [class.active]="selectedGroup?.id === group.id"
            [class.pinned-in-all]="group.isPinned"
            [attr.data-group-name]="group.name"
            (click)="selectGroup(group)">
            
            <div class="chat-avatar">
              <img *ngIf="group.avatar && group.avatar.startsWith('assets')" 
                   [src]="group.avatar" 
                   [alt]="group.name"
                   class="avatar-img">
              <div *ngIf="!group.avatar || !group.avatar.startsWith('assets')" 
                   class="avatar-placeholder">
                {{ group.avatar || group.name.charAt(0) }}
              </div>
              <div class="online-indicator" *ngIf="group.isOnline"></div>
            </div>
            
            <div class="chat-info">
              <div class="chat-header-info">
                <h3 class="chat-name">
                  {{ group.name }}
                  <i *ngIf="group.isPinned" class="fas fa-thumbtack pinned-icon"></i>
                </h3>
                <span class="chat-time">{{ group.lastMessageTime }}</span>
              </div>
              <div class="chat-preview">
                <p class="last-message">{{ group.lastMessage }}</p>
                <span *ngIf="group.unreadCount && group.unreadCount > 0" class="unread-badge">
                  {{ group.unreadCount }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Create New Group Button -->
      <div class="sidebar-footer">
        <button class="create-group-btn" (click)="createNewGroup()">
          <i class="fas fa-plus"></i>
          Create New Group
        </button>
      </div>
    </div>

    <!-- Main Chat Area -->
    <div class="chat-main" *ngIf="selectedGroup">
      <!-- Chat Header -->
      <div class="chat-main-header">
        <div class="chat-main-info">
          <div class="chat-avatar">
            <img *ngIf="selectedGroup.avatar && selectedGroup.avatar.startsWith('assets')" 
                 [src]="selectedGroup.avatar" 
                 [alt]="selectedGroup.name"
                 class="avatar-img">
            <div *ngIf="!selectedGroup.avatar || !selectedGroup.avatar.startsWith('assets')" 
                 class="avatar-placeholder">
              {{ selectedGroup.avatar || selectedGroup.name.charAt(0) }}
            </div>
            <div class="online-indicator" *ngIf="selectedGroup.isOnline"></div>
          </div>
          <div class="chat-details">
            <h2 class="chat-name">{{ selectedGroup.name }}</h2>
            <p class="chat-status" *ngIf="selectedGroup.memberCount && selectedGroup.memberCount > 0">
              <i class="fas fa-users"></i> {{ selectedGroup.memberCount }} members â€¢ 3 online
            </p>
          </div>
        </div>
        <div class="chat-actions">
          <button class="action-btn" title="Search in conversation">
            <i class="fas fa-search"></i>
          </button>
          <button class="action-btn" title="Call">
            <i class="fas fa-phone"></i>
          </button>
          <button class="action-btn" title="More options">
            <i class="fas fa-ellipsis-v"></i>
          </button>
        </div>
      </div>

      <!-- Messages Area -->
      <div class="messages-container" #messagesContainer>
        <div class="messages-content">
          <!-- Date Separator -->
          <div class="date-separator">
            <span>TODAY</span>
          </div>

          <!-- Messages -->
          <div *ngFor="let message of messages" class="message-wrapper">
            <div class="message" [class.own-message]="message.isCurrentUser">
              <div class="message-avatar" *ngIf="!message.isCurrentUser">
                <div class="avatar-placeholder">{{ message.senderAvatar }}</div>
              </div>
              
              <div class="message-content">
                <div class="message-header" *ngIf="!message.isCurrentUser">
                  <span class="sender-name">{{ message.senderName }}</span>
                  <span class="message-time">{{ formatMessageTime(message.timestamp) }}</span>
                </div>
                
                <!-- Text Message -->
                <div *ngIf="!message.messageType || message.messageType === 'text'" class="message-text">
                  {{ message.message }}
                </div>
                
                <!-- File Message -->
                <div *ngIf="message.messageType === 'file'" class="message-file">
                  <div class="file-icon">
                    <i class="fas fa-file-pdf"></i>
                  </div>
                  <div class="file-info">
                    <span class="file-name">{{ message.fileName }}</span>
                    <span class="file-size">{{ message.fileSize }} â€¢ PDF Document</span>
                  </div>
                  <button class="file-download" title="Download">
                    <i class="fas fa-download"></i>
                  </button>
                </div>
                
                <div class="message-time-own" *ngIf="message.isCurrentUser">
                  {{ formatMessageTime(message.timestamp) }}
                </div>
              </div>
            </div>
          </div>

          <!-- Typing Indicator -->
          <div class="typing-indicator" *ngIf="isTyping">
            <div class="typing-avatar">
              <div class="avatar-placeholder">SC</div>
            </div>
            <div class="typing-content">
              <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Message Input -->
      <div class="message-input-container">
        <div class="message-input-wrapper">
          <!-- Formatting Tools -->
          <div class="formatting-tools">
            <button class="format-btn" title="Bold">
              <i class="fas fa-bold"></i>
            </button>
            <button class="format-btn" title="Italic">
              <i class="fas fa-italic"></i>
            </button>
            <button class="format-btn" title="Underline">
              <i class="fas fa-underline"></i>
            </button>
            <button class="format-btn" title="Strikethrough">
              <i class="fas fa-strikethrough"></i>
            </button>
            <button class="format-btn" title="Code">
              <i class="fas fa-code"></i>
            </button>
          </div>

          <!-- Message Input -->
          <div class="input-area">
            <button class="input-btn" title="Attach file">
              <i class="fas fa-paperclip"></i>
              <input type="file" (change)="onFileSelected($event)" style="display: none;">
            </button>
            
            <textarea 
              #messageInput
              [(ngModel)]="newMessage"
              (keydown)="onKeyPress($event)"
              placeholder="Type your message here..."
              class="message-textarea"
              rows="1"></textarea>
            
            <button class="input-btn" (click)="toggleEmojiPicker()" title="Add emoji">
              <i class="fas fa-smile"></i>
            </button>
            
            <button class="send-btn" (click)="sendMessage()" [disabled]="!newMessage.trim()">
              Send
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>

          <!-- Footer -->
          <div class="input-footer">
            <span class="input-hint">Press Enter to send</span>
          </div>
        </div>

        <!-- Emoji Picker -->
        <div class="emoji-picker" *ngIf="showEmojiPicker">
          <div class="emoji-grid">
            <button *ngFor="let emoji of ['ðŸ˜€', 'ðŸ˜‚', 'ðŸ˜', 'ðŸ¤”', 'ðŸ‘', 'ðŸ‘Ž', 'â¤ï¸', 'ðŸŽ‰']" 
                    (click)="addEmoji(emoji)" 
                    class="emoji-btn">
              {{ emoji }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="chat-empty" *ngIf="!selectedGroup">
      <div class="empty-content">
        <i class="fas fa-comments"></i>
        <h3>Select a conversation</h3>
        <p>Choose from your existing conversations or start a new one</p>
      </div>
    </div>
  </div>
</div>