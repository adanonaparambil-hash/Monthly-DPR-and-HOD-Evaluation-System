<div class="past-reports-container" [@fadeInUp]="animationState">

  <!-- Page Header -->
  <div class="header-section">
    <h1>{{ getRoleBasedTitle() }}</h1>
    <p *ngIf="isEmployee">View your monthly performance reports</p>
    <p *ngIf="isHod">View and manage your team's performance reports</p>
    <p *ngIf="isCed">View all employee performance reports across the organization</p>
  </div>

  <!-- Filter Section -->
  <div class="filter-section" [@slideIn]>
    <div class="filter-row">
      <div class="filter-group" *ngIf="!isEmployee">
        <label>{{ getEmployeeNameLabel() }}</label>
        <input 
          type="text" 
          [(ngModel)]="filters.employeeName"
          (input)="onSearchChange()"
          [placeholder]="'Search ' + getEmployeeNameLabel().toLowerCase() + '...'"
          class="filter-input">
      </div>

      <div class="filter-group">
        <label>Month</label>
        <select 
          [(ngModel)]="filters.month"
          (change)="applyFilters()"
          class="filter-select">
          <option *ngFor="let month of months" [value]="month.value">
            {{ month.label }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label>Year</label>
        <select 
          [(ngModel)]="filters.year"
          (change)="applyFilters()"
          class="filter-select">
          <option *ngFor="let year of years" [value]="year.value">
            {{ year.label }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label>Status</label>
        <select 
          [(ngModel)]="filters.status"
          (change)="applyFilters()"
          class="filter-select">
          <option *ngFor="let status of statuses" [value]="status.value">
            {{ status.label }}
          </option>
        </select>
      </div>

      <div class="filter-group" *ngIf="isCed">
        <label>Department</label>
        <select [(ngModel)]="filters.department" (change)="applyFilters()" class="filter-select">
          <option value="">Select Department</option>
          <option *ngFor="let dept of departmentList" [value]="dept.idValue">
            {{ dept.description }}
          </option>
        </select>
      </div>
    </div>

    <div class="filter-actions">
      <button class="btn-filter" (click)="applyFilters()">
        <i class="fas fa-search"></i>
        Filter
      </button>
      <button class="btn-clear" (click)="clearFilters()">
        <i class="fas fa-times"></i>
        Clear
      </button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading reports...</p>
  </div>

  <!-- Table Section -->
  <div class="table-section" *ngIf="!loading">
    <div class="table-container">
      <table class="reports-table">
        <thead>
          <tr>
            <th>Sl No</th>
            <th>{{ getEmployeeNameLabel() }}</th>
            <th>Month</th>
            <th>Year</th>
            <th>HOD Name</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let report of getPaginatedReports(); let i = index" 
              class="table-row"
              [style.animation-delay]="(i * 0.1) + 's'">
            <td class="row-number">{{ getRowNumber(i) }}</td>
            <td class="employee-name">{{ report.employeeName }}</td>
            <td>{{ getMonthName(report.month) }}</td>
            <td>{{ report.year }}</td>
            <td>{{ report.hodName }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(report.status)">
                {{ getStatusLabel(report.status) }}
              </span>
            </td>
            <td class="action-cell">
              <button class="btn-view" (click)="viewReport(report.dprid)" title="View Report">
                <i class="fas fa-eye"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div *ngIf="filteredReports.length === 0" class="empty-state">
        <i class="fas fa-file-alt empty-icon"></i>
        <h3>No Reports Found</h3>
        <p>No reports match your current filter criteria.</p>
        <button class="btn-clear" (click)="clearFilters()">Clear Filters</button>
      </div>
    </div>

    <!-- Pagination Section -->
    <div class="pagination-section" *ngIf="filteredReports.length > 0">
      <div class="pagination-info">
        <span>Showing {{ (currentPage - 1) * pageSize + 1 }} to {{ Math.min(currentPage * pageSize, totalRecords) }} of {{ totalRecords }} results</span>
      </div>

      <div class="pagination-controls">
        <button 
          class="pagination-btn" 
          [disabled]="currentPage === 1"
          (click)="onPageChange(currentPage - 1)">
          Previous
        </button>

        <button 
          *ngFor="let page of getPageNumbers()"
          class="pagination-btn"
          [class.active]="page === currentPage"
          (click)="onPageChange(page)">
          {{ page }}
        </button>

        <button 
          class="pagination-btn" 
          [disabled]="currentPage === totalPages"
          (click)="onPageChange(currentPage + 1)">
          Next
        </button>
      </div>
    </div>
  </div>
</div>